{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}

<h1 class="text-2xl font-bold mb-4 text-blue-600 flex items-center gap-2">
    üì° D·ªØ li·ªáu NMEA m·ªõi nh·∫•t
</h1>
<img id="camera-feed" src="/static/loading.gif" width="640" height="480" class="rounded-xl shadow-md border border-gray-300 mb-4"  />


<div id="nmea" class="bg-white rounded-xl shadow p-6 space-y-2 border border-gray-200">
    <!-- D·ªØ li·ªáu s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
</div>

<script>
function renderData(obj, title) {
    let html = `<h2 class="text-lg font-semibold text-gray-700 mt-4">${title}</h2>`;
    for (let key in obj) {
        html += `
        <div class="flex justify-between border-b border-gray-100 py-1">
            <span class="font-medium text-gray-600">${key}</span>
            <span class="text-right text-gray-800">${obj[key]}</span>
        </div>`;
    }
    return html;
}

async function fetchData() {
    const res = await fetch('/data');
    const { nmea_data, pixhawk_data } = await res.json();

    let html = '';
    html += renderData(nmea_data, "üì° D·ªØ li·ªáu NMEA");
    html += renderData(pixhawk_data, "üõ©Ô∏è D·ªØ li·ªáu Pixhawk");

    document.getElementById('nmea').innerHTML = html;
}

setInterval(() => {
    fetch('/camera')
    .then(res => res.json())
    .then(data => {
        if (data.image) {
            document.getElementById("camera-feed").src = "data:image/jpeg;base64," + data.image;
        }
    });
},500); // c·∫≠p nh·∫≠t m·ªói 0.5s
setInterval(fetchData, 1000);  // c·∫≠p nh·∫≠t m·ªói gi√¢y
fetchData(); // l·∫ßn ƒë·∫ßu g·ªçi
</script>

{% endblock %}
